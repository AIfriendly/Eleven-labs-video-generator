# Epic 2 Retrospective: Core Video Generation Pipeline

**Date:** 2025-12-17  
**Epic:** 2 - Core Video Generation Pipeline  
**Stories Completed:** 7/7 (100%)

---

## ðŸ“Š Epic Summary

| Metric | Value |
|--------|-------|
| Stories Completed | 7 of 7 |
| FRs Delivered | FR1, FR5-14, FR23, FR30, FR35, FR35.1, FR36, FR42, FR45 |
| Code Reviews | 7 (all with fixes applied) |
| SDK Migrations | 1 (google-generativeai â†’ google-genai) |

### Stories Delivered

| Story | Title | Key Deliverable | Tests |
|-------|-------|-----------------|-------|
| 2.1 | Default Script Generation | `GeminiAdapter.generate_script()` | 17 |
| 2.2 | Default Text-to-Speech | `ElevenLabsAdapter.generate_speech()` | 22 |
| 2.3 | Default Image Generation | SDK migration + `generate_images()` | 24 |
| 2.4 | Video Compilation | `FFmpegVideoCompiler` | 20 |
| 2.5 | Progress Updates | `VideoPipelineProgress` | 25 |
| 2.6 | Interactive Generate Command | `VideoPipeline` orchestrator | CLI |
| 2.7 | Subtle Zoom Effects | Ken Burns zoom effects | 16 |

---

## âœ… What Went Well

### 1. Full Pipeline Integration
The complete video generation pipeline now works end-to-end: `eleven-video generate` takes a prompt and produces a finished video with script, voiceover, images, and professional zoom effects.

### 2. SDK Migration Success
Story 2.3 successfully migrated from deprecated `google-generativeai` SDK to `google-genai`, positioning the project well before the August 2025 deprecation deadline.

### 3. Pattern Reuse
Patterns established in Stories 2.1/2.2 were consistently reused:
- Settings class injection (dependency injection)
- `progress_callback: Callable[[str], None]` pattern
- `_format_error()` for user-friendly messages
- `@retry` decorator with tenacity

### 4. Code Review Effectiveness
All 7 stories went through adversarial code review. 3 stories had HIGH severity issues caught and fixed before merge.

### 5. Previous Retro Follow-Through
All 4 action items from Epic 1 retrospective were completed:
- âœ… API Reference documentation created and used
- âœ… Test fixtures created and reused extensively
- âœ… Env var naming standardized (ELEVENLABS/GEMINI)
- âœ… Test isolation rules followed

---

## ðŸ”´ What Was Challenging

### 1. Agent Package Manager Compliance
**Issue:** Dev and TEA agents struggled with Python environment despite `uv` rule.
- Agents would try `pip install` instead of modifying `pyproject.toml` + `uv pip install`
- "Unable to create process" errors during SDK transitions

**Root Cause:** Rule exists but isn't consistently followed by agents.

### 2. SDK Migration Cascade
**Issue:** Story 2.3 SDK change broke all existing test fixtures.
- Mocks needed updating from `genai.GenerativeModel` â†’ `genai.Client.models.generate_content`
- Pattern: SDK changes require test infrastructure updates

### 3. moviepy API Changes
**Issue:** Story 2.7 discovered `set_duration()` â†’ `with_duration()` API change in moviepy v2.2.1.
- Legacy tests needed updating for new API

### 4. Gemini API Rate Limits
**Issue:** Free tier rate limits blocked development velocity and don't refresh as expected.
- This is an infrastructural constraint that affects all future development
- **Decision:** Document OpenRouter as future alternative (see Action Items)

---

## ðŸ’¡ Key Insights

1. **SDK Migrations Need Test Fixture Planning** - Budget time for updating mocks, fixtures, and assertions.

2. **Code Review Catches What Tests Miss** - Retry logic gaps, type hint problems, and documentation sync issues.

3. **Pattern Reuse Accelerates Development** - Later stories (2.4-2.7) moved faster due to established patterns.

4. **Rate Limits Are Real Constraints** - API free tier limits affect development velocity and need alternative strategies.

---

## ðŸ”„ Epic 1 Action Item Follow-Through

| Action Item | Status |
|-------------|--------|
| Verify API endpoints â†’ Created `api-reference.md` | âœ… Completed |
| Create test fixtures â†’ Created `api_fixtures.py` | âœ… Completed |
| Document env var names | âœ… Completed |
| Test isolation check | âœ… Completed |

---

## ðŸ“ Action Items for Epic 3

### Process Improvements

| Action Item | Owner | Timeline |
|-------------|-------|----------|
| Strengthen agent `uv` directive - add pre-flight check to workflows | SM | Before Epic 3 |
| Add `// turbo` annotations for `uv pip install` commands | SM | Before Epic 3 |
| Document SDK migration testing strategy | Dev Lead | Before Epic 3 |

### Documentation Updates

| Action Item | Owner | Status |
|-------------|-------|--------|
| Add OpenRouter to PRD Future Scope (LLM + Image Gen) | SM | âœ… Done (this retro) |

> **OpenRouter Research (Dec 2025):**
> - Free LLM models: Llama 4, DeepSeek v3, Gemini 2.5 Pro (50-1000 req/day)
> - Free Image Gen: Google Nano Banana Pro, Sourceful Riverflow V2
> - Unified API reduces integration complexity
> - Daily limit regeneration (vs Gemini's unclear refresh)

### Technical Debt

- None identified - Epic 2 completed cleanly

---

## ðŸ”® Epic 3 Preview

**Epic 3: Pre-generation Customization**
- 8 stories (3.1-3.8)
- FRs: FR2, FR3, FR4, FR17-19, FR24, FR24.1, FR25.1, FR34, FR36.1

**Dependencies on Epic 2:**
- All adapters from Stories 2.1-2.3
- `VideoPipeline` from Story 2.6
- Progress display from Story 2.5

**Key Change:** Stories will expose model selection parameters currently hardcoded in adapters.

---

## ðŸ“‹ Retrospective Participants

- **Bob (Scrum Master)** - Facilitated
- **Revenant (Project Lead)** - Participated
- **Alice (Product Owner)** - Participated
- **Charlie (Senior Dev)** - Participated
- **Dana (QA Engineer)** - Participated
- **Elena (Junior Dev)** - Participated

---

## ðŸŽ¯ Key Takeaways

1. **Full pipeline works** - Users can now generate complete videos from prompts
2. **Patterns accelerate work** - Established patterns made later stories faster
3. **Agent tooling needs attention** - Package manager compliance is a process gap
4. **Rate limits need strategy** - OpenRouter documented as future alternative

---

*Previous retrospective: [Epic 1 Retro (2025-12-14)](./epic-1-stories/epic-1-retro-2025-12-14.md)*
